<div *ngIf="leafRecommendation" class="font-sans text-gray-100 rounded-lg">

    <p-accordion [multiple]="true" expandIcon="pi pi-chevron-down" collapseIcon="pi pi-chevron-up">

        <p-accordionTab *ngIf="leafRecommendation.corrections && leafRecommendation.corrections.length > 0">
            
            <ng-template pTemplate="header">
                <div class="flex items-center gap-2 text-gray-200">
                    <i class="pi pi-wrench text-orange-400"></i>
                    <span class="font-bold">Correções Necessárias</span>
                </div>
            </ng-template>

            <div class="space-y-4">
                <div *ngFor="let correction of leafRecommendation.corrections" 
                     class="p-4 bg-gray-700 rounded-lg border border-gray-600">
                    <div class="flex justify-between items-start mb-3">
                        
                        <h3 class="text-xl font-bold text-white">{{ getLeafNutrientDisplayName(correction.nutrientName) }}</h3>
                        
                        <p-tag [value]="correction.diagnosisLevel" [severity]="getDiagnosisSeverity(correction.diagnosisLevel)"></p-tag>
                    </div>
                    <p class="text-gray-300 mb-3 text-sm">{{ correction.recommendedActionTitle }}</p>
                    <ul class="space-y-2">
                        <li *ngFor="let product of correction.productOptions"
                            class="p-3 bg-gray-800 rounded-md flex justify-between items-center border-l-2 border-orange-500">
                            <span class="text-gray-200 font-medium">{{ product.name }}</span>
                            <span class="font-semibold text-orange-300">{{ product.recommendationText }}</span>
                        </li>
                    </ul>
                </div>
            </div>
        </p-accordionTab>

        <p-accordionTab *ngIf="leafRecommendation.maintenance">
            
            <ng-template pTemplate="header">
                <div class="flex items-center gap-2 text-gray-200">
                    <i class="pi pi-check-circle text-green-400"></i>
                    <span class="font-bold">{{ leafRecommendation.maintenance.title }}</span>
                </div>
            </ng-template>

            <div class="p-4 bg-gray-700 rounded-lg border border-gray-600">
                <p class="text-gray-300 mb-2">
                    Os seguintes nutrientes estão em níveis adequados na sua lavoura:
                </p>
                <div class="p-3 mb-4 bg-gray-800 rounded-md border-l-2 border-green-500">
                    <span class="font-bold text-lg text-green-300">
                        
                        {{ leafRecommendation.maintenance.adequateNutrients.map(getLeafNutrientDisplayName).join(', ') }}

                    </span>
                </div>
                <p class="text-gray-300 text-sm leading-relaxed">
                    <i class="pi pi-info-circle mr-1"></i>
                    {{ leafRecommendation.maintenance.recommendationText }}
                </p>
            </div>
        </p-accordionTab>

    </p-accordion>
</div>